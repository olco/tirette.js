let offset=[0,0],posTopLeft=[0,0],isDown=!1,currentTirette,currentLabel,currentLine,inputHeight=0,tirettes;function stateInit(tirettId,offsetLeft,offsetTop,clientX,clientY){let lineDown;isDown=!0,currentLine="tirette-line-"+(currentTirette=tirettId).split("-")[2],currentLabel="tirette-label-"+currentTirette.split("-")[2],document.getElementById(currentLine).style.opacity=1,offset=[offsetLeft-clientX,offsetTop-clientY],posTopLeft=[offsetLeft,offsetTop]}function stateMove(clientX,clientY){if(isDown){pointerPosition={x:clientX,y:clientY};let tiretteDown=document.getElementById(currentTirette);tiretteDown.style.left=pointerPosition.x+offset[0]+"px",tiretteDown.style.top=pointerPosition.y+offset[1]+"px";let topLeftX=posTopLeft[0],offsetX=offset[0],dist=distance(topLeftX,pointerPosition.x+offsetX,posTopLeft[1],pointerPosition.y+offset[1]),xMid=(topLeftX+(pointerPosition.x+offsetX))/2,yMid=(posTopLeft[1]+(pointerPosition.y+offset[1]))/2+inputHeight/2,inRad,inDeg=180*Math.atan2(pointerPosition.y+offset[1]-posTopLeft[1],pointerPosition.x+offsetX-topLeftX)/Math.PI,lineDown=document.getElementById(currentLine);lineDown.style.width=dist+"px",lineDown.style.top=yMid+"px",lineDown.style.left=xMid-dist/2+"px",lineDown.style.transform="rotate("+inDeg+"deg)";let inputsTirette,tiretteInput=document.getElementsByClassName("tirette")[currentTirette.split("-")[2]],min=tiretteInput.getAttribute("min"),max=tiretteInput.getAttribute("max"),accuracy=tiretteInput.getAttribute("accuracy"),computedValue=0;console.log(tiretteInput.tagName),"SELECT"==tiretteInput.tagName.toUpperCase()&&(min=0,max=tiretteInput.length-1),computedValue=(null!=min?parseInt(min):0)+Math.round(dist/(null!=accuracy?parseInt(accuracy):1));let showValue=!(null!=max&&parseInt(max)<computedValue),labelDown=document.getElementById(currentLabel);labelDown.style.opacity=1,showValue?("SELECT"==tiretteInput.tagName.toUpperCase()?tiretteInput.selectedIndex=computedValue:(tiretteInput.value=computedValue,labelDown.innerHTML=tiretteInput.value),labelDown.innerHTML=tiretteInput.value):("SELECT"==tiretteInput.tagName.toUpperCase()?tiretteInput.selectedIndex=parseInt(max):(tiretteInput.value=parseInt(max),labelDown.innerHTML=tiretteInput.value),labelDown.innerHTML=tiretteInput.value)}}function stateEnd(){if(isDown){isDown=!1;let tiretteDown=document.getElementById(currentTirette);tiretteDown.style.left=posTopLeft[0]+"px",tiretteDown.style.top=posTopLeft[1]+"px";let lineDown=document.getElementById(currentLine),labelDown;lineDown.style.width="1px",lineDown.style.opacity=0,document.getElementById(currentLabel).style.opacity=0}}function distance(x1,x2,y1,y2){let xx=(x1-x2)*(x1-x2),yy=(y1-y2)*(y1-y2);return Math.round(Math.sqrt(xx+yy))}document.addEventListener("DOMContentLoaded",ev=>{tirettes=document.getElementsByClassName("tirette");for(let i=0;i<tirettes.length;i++)!function(index){tirettes[index].insertAdjacentHTML("afterend",'<div class="tirette-line-'+index+'"id="tirette-line-'+index+'">&nbsp;</div><div class="tirette-handle-'+index+'"id="tirette-handle-'+index+'" dragable="true" ><div class="tirette-label-'+index+'"id="tirette-label-'+index+'">&nbsp;</div></div>');let tirette=document.getElementById("tirette-handle-"+index),line=document.getElementById("tirette-line-"+index),rect=tirettes[index].getBoundingClientRect(),rightPos=rect.right,leftPos=rect.left+(rect.right-rect.left)/2,topPos=rect.top+window.scrollY;inputHeight=rect.bottom-rect.top,line.style.left=rect.right+"px",line.style.top=topPos+parseInt((rect.bottom-rect.top)/2)+"px",tirette.style.width=inputHeight+"px",tirette.style.height=inputHeight+"px",tirette.style.left=rightPos+"px",tirette.style.top=topPos+"px",tirette.style.marginRight=rect.bottom-rect.top+"px",tirette.addEventListener("mousedown",function(e){e.preventDefault(),stateInit(this.id,this.offsetLeft,this.offsetTop,e.clientX,e.clientY),e.stopPropagation()},!0),document.addEventListener("mouseup",function(){stateEnd()},!0),document.addEventListener("mousemove",function(e){e.preventDefault(),stateMove(e.clientX,e.clientY),e.stopPropagation()},!0),tirette.addEventListener("dblclick",function(e){let inputsTirette,tiretteInput;e.preventDefault(),document.getElementsByClassName("tirette")[this.id.split("-")[2]].value="",e.stopPropagation()},!0),tirette.addEventListener("touchstart",function(e){e.preventDefault(),stateInit(this.id,this.offsetLeft,this.offsetTop,e.touches[0].clientX,e.touches[0].clientY),e.stopPropagation()},!0),document.addEventListener("touchend",function(){stateEnd()},!0),document.addEventListener("touchmove",function(e){e.preventDefault(),stateMove(e.touches[0].clientX,e.touches[0].clientY),e.stopPropagation()},!0)}(i)},!1);